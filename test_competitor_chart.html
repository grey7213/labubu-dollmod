<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>竞品分析象限图测试 - 云部署修复版</title>
    
    <!-- ECharts CDN with fallback -->
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js" 
            onerror="console.warn('主CDN加载失败，启用备用方案')"></script>
    
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #FFE4F1 0%, #E8F4FD 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.06);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
            color: #2D3748;
        }
        
        .test-header h1 {
            color: #FF6B9D;
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .test-info {
            background: #F7FAFC;
            border-left: 4px solid #4A90E2;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }
        
        .chart-container {
            width: 100%;
            height: 500px;
            border: 2px solid #E2E8F0;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
        }
        
        .loading {
            text-align: center;
            color: #4A5568;
        }
        
        .nav-links {
            text-align: center;
            margin-top: 20px;
        }
        
        .nav-links a {
            margin: 0 15px;
            color: #FF6B9D;
            text-decoration: none;
            font-weight: bold;
            padding: 8px 16px;
            border: 2px solid #FF6B9D;
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        
        .nav-links a:hover {
            background: #FF6B9D;
            color: white;
        }
        
        .status-indicator {
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }
        
        .status-success {
            background: #C6F6D5;
            color: #22543D;
            border: 1px solid #68D391;
        }
        
        .status-warning {
            background: #FEEBC8;
            color: #C05621;
            border: 1px solid #F6AD55;
        }
        
        .status-error {
            background: #FED7D7;
            color: #C53030;
            border: 1px solid #FC8181;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>🏆 竞品分析象限图测试</h1>
            <p>云部署优化版本 - Render环境兼容性测试</p>
        </div>
        
        <div class="test-info">
            <h3>🔧 修复内容说明</h3>
            <ul>
                <li><strong>渲染器优化</strong>: 强制使用canvas渲染器，提高云端兼容性</li>
                <li><strong>CDN备用方案</strong>: 多重CDN降级机制，确保ECharts库可用</li>
                <li><strong>图表配置增强</strong>: 优化坐标轴、标签、工具提示等配置</li>
                <li><strong>错误降级处理</strong>: 当图表渲染失败时显示备用内容</li>
                <li><strong>视觉优化</strong>: 调整气泡大小、颜色、边框等视觉效果</li>
            </ul>
        </div>
        
        <div id="status-indicator" class="status-indicator status-warning">
            ⏳ 正在初始化图表...
        </div>
        
        <div id="chart-container" class="chart-container">
            <div class="loading">
                <h3>📊 加载中...</h3>
                <p>正在生成竞品分析象限图</p>
            </div>
        </div>
        
        <div class="nav-links">
            <a href="/">← 返回主页</a>
            <a href="/chart/competitor">单独图表页面</a>
            <a href="/ppt">PPT版本</a>
            <a href="/test/media">媒体测试</a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const statusEl = document.getElementById('status-indicator');
            const chartContainer = document.getElementById('chart-container');
            
            // 检查ECharts是否加载成功
            function checkECharts() {
                if (typeof echarts !== 'undefined') {
                    statusEl.className = 'status-indicator status-success';
                    statusEl.textContent = '✅ ECharts加载成功，正在生成图表...';
                    createChart();
                } else {
                    statusEl.className = 'status-indicator status-error';
                    statusEl.textContent = '❌ ECharts加载失败，请检查网络连接';
                    showFallback();
                }
            }
            
            // 创建图表
            function createChart() {
                try {
                    const chart = echarts.init(chartContainer, 'romantic');
                    
                    const option = {
                        title: {
                            text: '🏆 潮玩行业竞品分析',
                            subtext: '市值vs品牌力象限图',
                            left: 'center',
                            top: '5%',
                            textStyle: {
                                color: '#2D3748',
                                fontSize: 16,
                                fontWeight: 'bold'
                            },
                            subtextStyle: {
                                color: '#4A5568',
                                fontSize: 12
                            }
                        },
                        tooltip: {
                            trigger: 'item',
                            formatter: '{b}<br/>市值: {c[0]}亿港元<br/>品牌力: {c[1]}分',
                            backgroundColor: 'rgba(255, 255, 255, 0.95)',
                            borderColor: '#FF6B9D',
                            borderWidth: 1,
                            textStyle: {
                                color: '#2D3748'
                            }
                        },
                        xAxis: {
                            name: '市值 (亿港元)',
                            type: 'log',
                            min: 10,
                            max: 5000,
                            axisLabel: {
                                color: '#4A5568',
                                formatter: '{value}'
                            },
                            axisLine: {
                                lineStyle: {
                                    color: '#E2E8F0'
                                }
                            },
                            splitLine: {
                                show: true,
                                lineStyle: {
                                    opacity: 0.3,
                                    color: '#E2E8F0'
                                }
                            }
                        },
                        yAxis: {
                            name: '品牌力指数',
                            min: 55,
                            max: 90,
                            axisLabel: {
                                color: '#4A5568',
                                formatter: '{value}'
                            },
                            axisLine: {
                                lineStyle: {
                                    color: '#E2E8F0'
                                }
                            },
                            splitLine: {
                                show: true,
                                lineStyle: {
                                    opacity: 0.3,
                                    color: '#E2E8F0'
                                }
                            }
                        },
                        series: [{
                            name: '竞品分析',
                            type: 'scatter',
                            symbolSize: 20,
                            data: [
                                {value: [3100, 85], name: '泡泡玛特'},
                                {value: [120, 72], name: '52TOYS'},
                                {value: [50, 68], name: 'TopToy'},
                                {value: [30, 65], name: '酷乐潮玩'},
                                {value: [25, 62], name: 'IP小站'},
                                {value: [800, 78], name: '万代'},
                                {value: [180, 70], name: 'MINISO名创'}
                            ],
                            itemStyle: {
                                color: '#FF6B9D',
                                opacity: 0.8,
                                borderColor: '#FFFFFF',
                                borderWidth: 3
                            },
                            label: {
                                show: true,
                                position: 'right',
                                formatter: '{b}',
                                fontSize: 10,
                                color: '#2D3748'
                            }
                        }]
                    };
                    
                    chart.setOption(option);
                    
                    // 响应式处理
                    window.addEventListener('resize', function() {
                        chart.resize();
                    });
                    
                    statusEl.className = 'status-indicator status-success';
                    statusEl.textContent = '🎉 象限图生成成功！数据来源：泡泡玛特官方财报';
                    
                } catch (error) {
                    console.error('图表创建失败:', error);
                    statusEl.className = 'status-indicator status-error';
                    statusEl.textContent = '❌ 图表创建失败: ' + error.message;
                    showFallback();
                }
            }
            
            // 显示降级内容
            function showFallback() {
                chartContainer.innerHTML = `
                    <div style="text-align: center; color: #2D3748; padding: 40px;">
                        <h3 style="margin-bottom: 20px;">🏆 潮玩行业竞品分析</h3>
                        <p style="margin-bottom: 30px; color: #4A5568;">市值vs品牌力象限图</p>
                        <div style="background: #F7FAFC; padding: 20px; border-radius: 8px; border: 1px solid #E2E8F0;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; text-align: left;">
                                <div><strong>🎯 泡泡玛特</strong><br>市值: 3100亿港元<br>品牌力: 85分</div>
                                <div><strong>🎮 万代</strong><br>市值: 800亿港元<br>品牌力: 78分</div>
                                <div><strong>🛍️ MINISO名创</strong><br>市值: 180亿港元<br>品牌力: 70分</div>
                                <div><strong>🧸 52TOYS</strong><br>市值: 120亿港元<br>品牌力: 72分</div>
                                <div><strong>🌟 TopToy</strong><br>市值: 50亿港元<br>品牌力: 68分</div>
                                <div><strong>🎨 酷乐潮玩</strong><br>市值: 30亿港元<br>品牌力: 65分</div>
                                <div><strong>📦 IP小站</strong><br>市值: 25亿港元<br>品牌力: 62分</div>
                            </div>
                            <p style="margin-top: 20px; color: #4A5568; font-style: italic;">
                                数据显示泡泡玛特在市值和品牌力方面均处于行业领先地位
                            </p>
                        </div>
                    </div>
                `;
            }
            
            // 延迟检查ECharts加载状态
            setTimeout(checkECharts, 1000);
        });
    </script>
</body>
</html> 